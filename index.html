<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>tBNB Faucet – 0.3 tBNB</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: #0f172a;
      padding: 1.75rem;
      border-radius: 1.25rem;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 24px 60px rgba(0,0,0,.6);
    }
    h1 {
      margin: 0 0 .25rem;
      font-size: 1.5rem;
    }
    .subtitle {
      margin: 0 0 1.25rem;
      font-size: .9rem;
      color: #9ca3af;
    }
    label {
      display: block;
      font-size: .85rem;
      margin-bottom: .25rem;
    }
    input {
      width: 100%;
      padding: .6rem .7rem;
      border-radius: .75rem;
      border: 1px solid #374151;
      background: #020617;
      color: #f9fafb;
      font-size: .95rem;
      outline: none;
      margin-bottom: .75rem;
    }
    input:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px #4f46e5;
    }
    button {
      width: 100%;
      padding: .7rem 1rem;
      border-radius: 999px;
      border: none;
      font-size: .95rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: .5rem;
      background: #10b981;
      color: white;
      box-shadow: 0 12px 30px rgba(16,185,129,.5);
      transition: transform .05s, box-shadow .05s, opacity .2s;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    button[disabled] {
      opacity: .5;
      cursor: not-allowed;
      box-shadow: none;
    }
    .hint {
      font-size: .8rem;
      color: #9ca3af;
      margin-top: .75rem;
    }
    .log {
      margin-top: .75rem;
      font-size: .85rem;
      background: #020617;
      border-radius: .75rem;
      padding: .75rem;
      max-height: 180px;
      overflow: auto;
      border: 1px solid #111827;
    }
    .log-item {
      display: flex;
      gap: .5rem;
      align-items: flex-start;
      padding: .5rem .6rem;
      border-radius: .6rem;
      border: 1px solid #111827;
      background: #0b1220;
      color: #e5e7eb;
      margin-bottom: .5rem;
    }
    .log-item:last-child { margin-bottom: 0; }
    .log-item .icon { font-size: 1rem; line-height: 1.2; }
    .log-item .content { flex: 1; }
    .log-item.info { border-left: 4px solid #4f46e5; }
    .log-item.success { border-left: 4px solid #10b981; }
    .log-item.error { border-left: 4px solid #ef4444; }
    .log-item a { color: #93c5fd; text-decoration: none; }
    .log-item a:hover { text-decoration: underline; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #0b1220; padding: 0 .25rem; border-radius: .3rem; }
  </style>
</head>
<body>
  <div class="card">
    <h1>tBNB Faucet</h1>
    <p class="subtitle">Get <b>0.3 tBNB</b> on BSC Testnet (chainId 97)</p>

    <label for="addr">Recipient address</label>
    <input id="addr" placeholder="0x..." autocomplete="off" />

    <button id="btn">Request 0.3 tBNB</button>

    <p class="hint">
      • Network: <b>BNB Smart Chain Testnet</b> (tBNB).<br/>
      • No BNB required by you; faucet pays gas.<br/>
      • Cooldown per address enforced by the contract.
    </p>

    <div id="log" class="log" aria-live="polite" aria-atomic="false"></div>
  </div>

<script>
  const btn = document.getElementById("btn");
  const logEl = document.getElementById("log");

  function shortenAddress(addr) {
    return addr ? addr.slice(0, 6) + "…" + addr.slice(-4) : "";
  }

  function log(msg, type = "info", { html = false, icon } = {}) {
    const wrap = document.createElement("div");
    wrap.className = `log-item ${type}`;

    const iconEl = document.createElement("div");
    iconEl.className = "icon";
    iconEl.textContent = icon || (type === "success" ? "✅" : type === "error" ? "❌" : "⏳");

    const contentEl = document.createElement("div");
    contentEl.className = "content";
    if (html) contentEl.innerHTML = msg; else contentEl.textContent = msg;

    wrap.appendChild(iconEl);
    wrap.appendChild(contentEl);
    logEl.appendChild(wrap);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function isHexAddress(addr) {
    return /^0x[a-fA-F0-9]{40}$/.test(addr);
  }

  btn.addEventListener("click", async () => {
    const to = document.getElementById("addr").value.trim();

    if (!isHexAddress(to)) {
      alert("Please enter a valid 0x address.");
      return;
    }

    btn.disabled = true;
    log("Requesting 0.3 tBNB for " + shortenAddress(to) + "…", "info", { icon: "⏳" });

    try {
      const url = "/api/drip?to=" + encodeURIComponent(to);
      const res = await fetch(url, { method: "POST" });

      const text = await res.text();
      let data;
      try { data = JSON.parse(text); } catch { data = { raw: text }; }

      if (!res.ok) {
        log("Error: " + (data.error || text), "error");
        alert("Error: " + (data.error || text));
      } else {
        const explorer = "https://testnet.bscscan.com/tx/" + data.hash;
        const html = `Sent <b>0.3 tBNB</b> to <code>${shortenAddress(to)}</code> — <a href="${explorer}" target="_blank" rel="noopener">View on BscScan</a>`;
        log(html, "success", { html: true });
      }
    } catch (err) {
      console.error(err);
      log("Request failed: " + (err.message || err), "error");
      alert("Request failed: " + (err.message || err));
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
